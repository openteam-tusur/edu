<% title @curriculum.title %>

<fieldset class="additional_info">
  <div>
    <p>
      <span class="duration">Срок обучения <%= @curriculum.duration %></span>
      <% if @curriculum.attachment %>
        <%= link_to image_tag("icon_pdf_#{@curriculum.access}.png"),
                    @curriculum.attachment.data.url,
                    :title => @curriculum.human_access, :rel => "tipsy" %>
        <%= link_to "Учебный план #{@curriculum.year}", @curriculum.attachment.data.url,
                    :class => "#{@curriculum.access}_pdf download" %>
      <% else %>
        файл отсутствует
      <% end %>
    </p>
  </div>
</fieldset>

<ul class="curriculum_action">
  <li><%= link_to t(:edit), edit_manage_chair_curriculum_path(@chair, @curriculum), :class => "button" %></li>
  <% @curriculum.aasm_events_for_current_state.each do |event| %>
    <li class="curriculum_resource_state">
      <p class="resource_state_<%= @curriculum.state %>"><%= @curriculum.human_state %></p>
      <%= link_to @curriculum.human_event_name(event),
                  transit_manage_chair_curriculum_path(@chair, @curriculum, :event => event),
                  :class => "button", :method => :put %>
    </li>
  <% end %>
</ul>

<h2>Семестры</h2>

<div class="curriculum_semesters">
  <table class="semesters_header">
    <tr>
      <% (1..@curriculum.cources_count).each do |cource| %>
        <th colspan="2"><%= "#{cource} курс" %></th>
      <% end %>
    </tr>
    <tr>
      <% @curriculum.semesters.each do |semester| %>
        <td<%= semester.eql?(@semester) ? " class='current'" : ""%>>
          <%= link_to semester.number,
                      manage_chair_curriculum_semester_path(@chair, @curriculum, semester) %>
        </td>
      <% end %>
      <%= content_tag :td, "" unless @curriculum.semesters_count.even? %>
    </tr>
  </table>
  <div class="semester_body">
    <% unless @semester.educations.empty? %>
      <% @semester.educations.each do |education| %>
        <div class="discipline <%= cycle('odd', 'even') %>">
          <div class="discipline_name">
            <%= education.study.discipline.name %>
            <abbr title="<%= education.chair.name %>" rel="tipsy"><%= education.chair.abbr %></abbr>
            (<%= education.examinations.collect(&:name).join(", ").mb_chars.downcase %>)
          </div>
          <div class="discipline_edit">
            <%= link_to t("edit"),
                        edit_manage_chair_curriculum_study_path(@chair, @curriculum, education.study),
                        :title => t("edit"), :rel => "tipsy" %>
          </div>
        </div>
      <% end %>
    <% else %>
      <p>Дисциплины не заполнены</p>
    <% end %>
    <p class="action"><%= link_to "Добавить дисциплину",
                   new_manage_chair_curriculum_semester_education_path(@chair, @curriculum, @semester),
                   :class => "button" %></p>
  </div>
</div>

<div class="cycles">
  <% Plan::Study.enum[:cycle].each do |cycle| %>
    <div class="cycle">
      <span><%= Plan::Study.human_enum[:cycle][cycle.to_sym] %></span>
      <% if (@curriculum.studies.send "cycle_#{cycle}").empty? %>
        <p>Нет дисциплин</p>
      <% else %>
        <ul>
          <% (@curriculum.studies.send "cycle_#{cycle}").each do |study| %>
            <li>
              <span><%= study.discipline.name %></span>
              <abbr title="<%= study.chair.name %>" rel="tipsy"><%= study.chair.abbr %></abbr>
              <div class="discipline_edit">
                <%= link_to t("edit"),
                            edit_manage_chair_curriculum_study_path(@chair, @curriculum, study),
                            :title => t("edit"), :rel => "tipsy" %>
              </div>
              <ul>
                <% study.semesters.each do |semester| %>
                 <li>
                  <%= "#{semester.number} семестр " %>
                  <% semester.educations.each do |education| %>
                    <%= "(#{education.examinations.collect(&:name).join(', ').mb_chars.downcase})" unless education.examinations.empty? %>
                  <% end %>
                 </li>
                <% end %>
              </ul>
            </li>
          <% end %>
        </ul>
      <% end %>
    </div>
  <% end %>
</div>

<p><%= link_to "Добавить дисциплину",
               new_manage_chair_curriculum_study_path(@chair, @curriculum),
               :class => "button" %></p>

